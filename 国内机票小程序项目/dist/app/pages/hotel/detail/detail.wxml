<include src="./detail-skeleton.wxml" wx:if="{{!detail}}"></include>
<view class="container" wx:else>
    <view class="pictures-wrapper">
        <view wx:if="{{imgList.length}}" bindtap="throttleToPictures">
            <swiper indicator-dots="{{false}}" autoplay="{{true}}">
                <block wx:for="{{imgList}}" wx:key="item">
                    <swiper-item>
                        <!-- 默认图片无法填充，所以设置背景色 -->
                        <image src="{{item}}" style="background:#cde7ff;" />
                    </swiper-item>
                </block>
            </swiper>
            <view class="to-pictures text-white f-s-10">
                <iconfont icon="album" class="m-l-4" />
                <text class="m-x-4">{{ detail.pictures.length }}</text>
            </view>
        </view>
        <image wx:else src="{{detail.mainPictureUrl}}" class="h-190 w-full" style="background:#cde7ff;" />
    </view>
    <view class="info bg-white">
        <view class="f-s-16 m-b-6">
            <text class="m-r-8">{{detail.hotelName}}</text>
            <iconfont icon="star" class="icon-star" wx:for="{{stars}}" wx:key="index"></iconfont>
        </view>
        <view class="f-s-16 m-b-6 text-orange1 f-w-bold">
            <block wx:if="{{scoreInfo.scoreDesc.length > 0}}">
                <text>{{ scoreInfo.scoreDesc }}</text>
                <text class="f-s-12">分</text>
            </block>
            <view class="d-inline-block m-l-4">{{ scoreInfo.extDesc }}</view>
        </view>
        <view class="f-s-12 d-flex">
            <view class="flex-1 d-flex p-r-4 text-primary" bindtap="throttleOpenLocation">
                <iconfont icon="address" class="m-r-6"></iconfont>
                <text>{{detail.address}}</text>
            </view>
            <view bindtap="throttleScrollToDetail">
                <text class="text-primary">电话/详情</text>
                <iconfont icon="arrow-right" class="f-s-10 text-primary m-l-2" />
            </view>
        </view>
    </view>
    <view class="sticky z-index-1" style="top:0">
        <view class="booking-info-wrapper bg-white">
            <view class="booking-date" bindtap="throttleChooseDate">
                <date-format class="text-primary m-r-4 f-w-bold" value="{{params.checkInDate}}" format="MMMdo" />
                <text class="f-s-12">{{checkInDateAlias}}</text>
                <text class="total-days text-primary">共{{totalDays}}晚</text>
                <date-format class="text-primary m-r-4 f-w-bold" value="{{params.checkOutDate}}" format="MMMdo" />
                <text class="f-s-12">{{checkOutDateAlias}}</text>
                <view class="flex-1 text-right">
                    <iconfont icon="arrow-right" class="f-s-10 text-primary" />
                </view>
            </view>
        </view>
        <block wx:if="{{!isEmpty}}">
            <view class="d-flex supplier-wrapper bg-white text-center f-s-14 text-grey2 p-t-8" wx:if="{{supplierTabVisible}}">
                <view class="flex-1  d-flex justify-content-center {{currentSupplier?'':'activated'}}" bind:tap="throttleChangeCurrentSupplier">
                    <view>
                        <view class="m-b-8">推荐产品</view>
                        <view class="indicator"></view>
                    </view>
                </view>
                <view class="flex-1 d-flex justify-content-center {{currentSupplier===item.supplier?'activated':''}}" wx:for="{{supplierGroups}}" wx:key="supplier" bind:tap="throttleChangeCurrentSupplier" data-supplier="{{item.supplier}}">
                    <view>
                        <view class="m-b-8">{{item.supplierName}}</view>
                        <view class="indicator"></view>
                    </view>
                </view>
            </view>
        </block>
    </view>
    <block wx:if="{{!isEmpty}}">
        <block wx:if="{{!currentSupplier}}">
            <block wx:for="{{recommendGroup}}" wx:key="supplier">
                <room-list group="{{item}}" bind:openRoomDetailPopup="throttleOpenRoomDetailPopup" bind:book="throttleBook"></room-list>
                <view class="bg-white m-y-4 p-y-12 text-center l-h-0">
                    <button class="r-full text-primary b-primary b-1 f-s-12 h-26 l-h-26 d-inline-block" bindtap="throttleChangeCurrentSupplier" data-supplier="{{item.supplier}}">
                        查看{{item.supplierName}}全部房型
                    </button>
                </view>
            </block>
        </block>
        <block wx:else>
            <block wx:for="{{supplierGroups}}" wx:key="supplier">
                <block wx:if="{{currentSupplier===item.supplier}}">
                    <room-list group="{{item}}" supplierName="{{item.supplierName}}" supplier="{{item.supplier}}" bind:openRoomDetailPopup="throttleOpenRoomDetailPopup" bind:book="throttleBook"></room-list>
                </block>
            </block>
        </block>
    </block>
    <view wx:else class="text-center bg-white p-y-12">
        <view class="d-inline-block b-1 b-primary r-full f-s-12 p-y-4 p-x-20 text-primary">
            当前日期暂无房间
        </view>
    </view>
    <view class="m-b-4 p-y-12 p-x-16 bg-white" id="detail_begin">
        <text class="f-s-18 f-w-500 m-b-10">{{detail.hotelName}}</text>
        <view class="m-b-4">
            <iconfont icon="star" class="icon-star" wx:for="{{stars}}" wx:key="index"></iconfont>
        </view>
        <view class="f-s-12 text-grey2">{{ detail.shortDescription ||'' }}</view>
    </view>
    <view class="bg-white p-16 f-s-14 m-b-4 d-flex align-items-center" bindtap="throttleShowPhoneCall">
        <text class="flex-1">酒店电话：{{telList[0]}}</text>
        <iconfont icon="phonecall" class="text-primary f-s-18" />
    </view>
    <view class="bg-white p-y-12 p-x-16">
        <view class="m-b-12">
            <text class="f-s-18 f-w-500">酒店设施</text>
        </view>
        <view class="m-b-12">
            <view class="f-s-14 m-b-8">交通设施</view>
            <view class="f-s-12 text-grey2">{{ detail.facilities.parking || '无' }}</view>
        </view>
        <view class="m-b-12">
            <view class="f-s-14 m-b-8">网络</view>
            <view class="f-s-12 text-grey2">{{ detail.facilities.wifi || '无' }}</view>
        </view>
        <view class="m-b-12">
            <view class="f-s-14 m-b-8">餐饮服务</view>
            <view class="f-s-12 text-grey2">{{ detail.facilities.diningRoom || '无' }}</view>
        </view>
        <view class="m-b-12">
            <view class="f-s-14 m-b-8">商务服务</view>
            <view class="f-s-12 text-grey2">{{ detail.facilities.boardRoom || '无' }}</view>
        </view>
        <view>
            <view class="f-s-14 m-b-8">其他服务</view>
            <view class="f-s-12 text-grey2">
                <text>
                    {{ detail.facilities.swimmingPool||'' }} {{ detail.facilities.gymnasium||'' }}
                </text>
            </view>
        </view>
    </view>
    <view class="p-t-18 p-b-36 text-center">
        <image src="{{OSSPrefix}}/hotel/hotel-ad@2x.png" style="width: 632rpx;height: 224rpx;" />
    </view>
</view>
<van-calendar show="{{ calenderVisible }}" type="range" bind:confirm="throttleDateConfirm" bind:close="throttleDateClose" formatter="{{ formatter }}" max-date="{{maxdate}}" default-date="{{calendarDefaultDate}}" show-confirm="{{false}}" />
<van-action-sheet show="{{ phoneCallActionVisible }}" actions="{{ phoneCallActions }}" bind:cancel="throttlePhoneCallActionClose" bind:close="throttlePhoneCallActionClose" bind:select="throttlePhoneCallActionSelect" cancel-text="取消" />
<van-popup show="{{roomDetailPopupVisible }}" round="true" position="bottom" lock-scroll="true" bind:close="throttleCloseRoomDetailPopup" closeable>
    <room-detail-popup room="{{room}}" ratePlan="{{ratePlan}}" bind:book="throttleBook"></room-detail-popup>
</van-popup>
