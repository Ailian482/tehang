<view class="nav-header-placeholder"></view>
<view class="nav-header" id="approval-nav-header">
    <!-- 存在审批权限 -->
    <block wx:if="{{approvalEnabled}}">
        <view class="nav-item {{ current === 0 ? 'active' : ''}}" data-index="{{0}}" data-type="{{approvalProcessType.Approval}}" data-status="{{true}}" bindtap="handleChange">
            待我审批
            <view wx:if="{{approvalToAuditNum}}" class="dot"></view>
        </view>
        <view class="nav-item {{ current === 1 ? 'active' : ''}}" data-index="{{1}}" data-type="{{approvalProcessType.Approval}}" data-status="{{false}}" bindtap="handleChange">
            已审批
        </view>
    </block>
    <!-- 存在授权权限 -->
    <block wx:if="{{authorizeEnabled}}">
        <view class="nav-item {{ current === 2 ? 'active' : ''}}" data-index="{{2}}" data-type="{{approvalProcessType.Authorize}}" data-status="{{authorizeSheetHandleStatus.WaitHandle}}" bindtap="handleChange">
            待我授权
            <view wx:if="{{authorizeToAuditNum}}" class="dot"></view>
        </view>
        <view class="nav-item {{ current === 3 ? 'active' : ''}}" data-index="{{3}}" data-type="{{approvalProcessType.Authorize}}" data-status="{{authorizeSheetHandleStatus.Handled}}" bindtap="handleChange">
            已授权
        </view>
    </block>
</view>
<view class="approval-list-content">
    <!-- 屏幕高度 - tabBar高度 - header 高度 - 间距10px -->
    <scroll-view style="height: calc(100vh - {{tabBarHeight}}px - 78px - 10px)" scroll-y="true" refresher-enabled="true" refresher-triggered="{{triggered}}" bindrefresherrefresh="handleRefresherPull" lower-threshold="50" bindscrolltolower="handleReachBottom">
        <block wx:if="{{approvalProcessList && approvalProcessList.length}}">
            <!-- 审批流Item -->
            <block wx:if="{{selectedApprovalType === approvalProcessType.Approval}}">
                <block wx:for="{{approvalProcessList}}" wx:for-item="approvalItem" wx:for-index="idx" wx:key="id">
                    <view class="list-item" data-id="{{approvalItem.id}}" bindtap="toApprovalProcessDetail">
                        <view class="detail-row">
                            <view class="label">出差人：</view>
                            <view class="value d-flex justify-content-sp-bw align-items-center">
                                <view>{{ approvalItem.employeeNamesStr }}</view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">行程：</view>
                            <view class="value">
                                <view wx:for="{{approvalItem.travelPlaces}}" wx:for-item="travelPlace" wx:key="*this">
                                    {{travelPlace}}
                                </view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">出差时间：</view>
                            <view class="value">
                                <view wx:for="{{approvalItem.travelDates}}" wx:for-item="travelDate" wx:key="*this">
                                    {{travelDate}}
                                </view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">交通工具：</view>
                            <view class="value">
                                <view wx:for="{{approvalItem.transports}}" wx:for-item="transport" wx:key="*this">
                                    {{transport}}
                                </view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">出差事由：</view>
                            <view class="value">{{approvalItem.travelReason}}</view>
                        </view>
                        <view class="status-operate">
                            <view class="f-w-bold {{approvalStatusOps[approvalItem.status].textColor}}">
                                <dict-transform dict="ApprovalStatus" code="{{approvalItem.status}}"></dict-transform>
                            </view>
                            <view class="d-flex" wx:if="{{approvalItem.operation.canBeAudited}}">
                                <view class="operate-btn" data-id="{{approvalItem.id}}" catchtap="handleShowRejectReason">
                                    拒绝
                                </view>
                                <view class="operate-btn m-l-16" data-id="{{approvalItem.id}}" catchtap="handleAgree">
                                    同意
                                </view>
                            </view>
                        </view>
                        <view class="status-watermark">
                            <image class="status-image" src="{{approvalStatusOps[approvalItem.status].imageUrl}}" lazy-load="true" />
                        </view>
                    </view>
                </block>
            </block>
            <!-- 授权流Item -->
            <block wx:else>
                <block wx:for="{{approvalProcessList}}" wx:for-item="authorizeItem" wx:for-index="idx" wx:key="id">
                    <view class="list-item" data-id="{{authorizeItem.id}}" bindtap="toAuthorizeProcessDetail">
                        <view class="detail-row">
                            <view class="label">出差人：</view>
                            <view class="value d-flex justify-content-sp-bw align-items-center">
                                <view>{{ authorizeItem.travellerName }}</view>
                                <view class="f-s-12">{{authorizeItem.travelDate}}</view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">订单号：</view>
                            <view class="value">{{ authorizeItem.bigOrderNo }}</view>
                        </view>
                        <view class="detail-row">
                            <view class="label">订单备注：</view>
                            <view class="value">{{authorizeItem.orderDesc}}</view>
                        </view>
                        <view class="detail-row">
                            <view class="label">业务类型：</view>
                            <view class="value">
                                <dict-transform dict="BizType" code="{{authorizeItem.bizType}}"></dict-transform>
                            </view>
                        </view>
                        <view class="status-operate">
                            <view class="f-w-bold {{authorizeStatusOps[authorizeItem.status].textColor}}">
                                <dict-transform dict="AuthorizeStatus" code="{{authorizeItem.status}}"></dict-transform>
                            </view>
                            <view class="d-flex" wx:if="{{authorizeItem.canAudit}}">
                                <view class="operate-btn" data-id="{{authorizeItem.id}}" catchtap="handleShowRejectReason">
                                    拒绝
                                </view>
                                <view class="operate-btn m-l-16" data-id="{{authorizeItem.id}}" catchtap="handleAgree">
                                    同意
                                </view>
                            </view>
                        </view>
                        <view class="status-watermark">
                            <image class="status-image" src="{{authorizeStatusOps[authorizeItem.status].imageUrl}}" lazy-load="true" />
                        </view>
                    </view>
                </block>
            </block>
        </block>
        <view wx:else>
            <empty-list type="approval" tips="暂无审批内容"></empty-list>
        </view>
    </scroll-view>
</view>
<!-- 拒绝审批/授权时展示弹窗 -->
<van-action-sheet show="{{ showRejectReason }}" title="填写原因" bind:close="handleCloseRejectReason" bind:click-overlay="handleCloseRejectReason">
    <view class="reject-container">
        <view class="p-x-24">
            <view class="f-s-14 text-grey1">确认拒绝该审批单吗？</view>
            <view class="textarea-content">
                <textarea bindblur="bindTextAreaBlur" placeholder="请填写拒绝理由（非必填）" />
            </view>
        </view>
        <view class="confirm-btn" bindtap="handleReject">确定</view>
    </view>
</van-action-sheet>