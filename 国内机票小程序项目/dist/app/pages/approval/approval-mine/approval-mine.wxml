<view class="nav-header-placeholder"></view>
<view class="nav-header" id="approval-nav-header">
    <!-- 存在审批权限 -->
    <block wx:if="{{approvalEnabled}}">
        <view class="nav-item {{ current === 0 ? 'active' : ''}}" data-index="{{0}}" data-type="{{approvalProcessType.Approval}}" data-status="{{[approvalStatus.WaitApproval, approvalStatus.Cancelled]}}" bindtap="handleChange">
            待审批
        </view>
        <view class="nav-item {{ current === 1 ? 'active' : ''}}" data-index="{{1}}" data-type="{{approvalProcessType.Approval}}" data-status="{{[approvalStatus.Passed , approvalStatus.Rejected]}}" bindtap="handleChange">
            已审批
        </view>
    </block>
    <!-- 存在授权权限 -->
    <block wx:if="{{authorizeEnabled}}">
        <view class="nav-item {{ current === 2 ? 'active' : ''}}" data-index="{{2}}" data-type="{{approvalProcessType.Authorize}}" data-status="{{[authorizeStatus.WaitAuthorize]}}" bindtap="handleChange">
            待授权
        </view>
        <view class="nav-item {{ current === 3 ? 'active' : ''}}" data-index="{{3}}" data-type="{{approvalProcessType.Authorize}}" data-status="{{[authorizeStatus.Passed, authorizeStatus.Rejected,authorizeStatus.WaitAuthorize]}}" bindtap="handleChange">
            已授权
        </view>
    </block>
</view>
<view class="approval-list-content" id="root">
    <!-- 屏幕高度 - tabBar高度 - header 高度 - 间距10px -->
    <scroll-view style="height: calc(100vh - {{tabBarHeight}}px - 78px - 10px)" scroll-y="true" refresher-enabled="true" refresher-triggered="{{triggered}}" bindrefresherrefresh="handleRefresherPull" lower-threshold="50" bindscrolltolower="handleReachBottom">
        <block wx:if="{{approvalProcessList && approvalProcessList.length}}">
            <!-- 审批流Item -->
            <block wx:if="{{selectedApprovalType === approvalProcessType.Approval}}">
                <block wx:for="{{approvalProcessList}}" wx:for-item="approvalItem" wx:for-index="idx" wx:key="id">
                    <view class="list-item" data-id="{{approvalItem.id}}" bindtap="toApprovalProcessDetail">
                        <view class="detail-row">
                            <view class="label">出差人：</view>
                            <view class="value d-flex justify-content-sp-bw align-items-center">
                                <view>{{ approvalItem.employeeNamesStr }}</view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">行程：</view>
                            <view class="value">
                                <view wx:for="{{approvalItem.travelPlaces}}" wx:for-item="travelPlace" wx:key="*this">
                                    {{travelPlace}}
                                </view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">出差时间：</view>
                            <view class="value">
                                <view wx:for="{{approvalItem.travelDates}}" wx:for-item="travelDate" wx:key="*this">
                                    {{travelDate}}
                                </view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">交通工具：</view>
                            <view class="value">
                                <view wx:for="{{approvalItem.transports}}" wx:for-item="transport" wx:key="*this">
                                    {{transport}}
                                </view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">出差事由：</view>
                            <view class="value">{{approvalItem.travelReason}}</view>
                        </view>
                        <view class="status-operate">
                            <view class="f-w-bold {{approvalStatusOps[approvalItem.status].textColor}}">
                                <dict-transform dict="ApprovalStatus" code="{{approvalItem.status}}"></dict-transform>
                            </view>
                            <view class="operate-btn" wx:if="{{approvalItem.operation.canBeCanceled}}" data-id="{{approvalItem.id}}" catchtap="handleCancel">
                                撤销
                            </view>
                        </view>
                        <view class="status-watermark">
                            <image class="status-image" src="{{approvalStatusOps[approvalItem.status].imageUrl}}" lazy-load="true" />
                        </view>
                    </view>
                </block>
            </block>
            <!-- 授权流Item -->
            <block wx:else>
                <block wx:for="{{approvalProcessList}}" wx:for-item="authorizeItem" wx:for-index="idx" wx:key="id">
                    <view class="list-item" data-id="{{authorizeItem.id}}" bindtap="toAuthorizeProcessDetail">
                        <view class="detail-row">
                            <view class="label">出差人：</view>
                            <view class="value d-flex justify-content-sp-bw align-items-center">
                                <view>{{ authorizeItem.travellerName }}</view>
                                <view class="f-s-12">{{authorizeItem.travelDate}}</view>
                            </view>
                        </view>
                        <view class="detail-row">
                            <view class="label">订单号：</view>
                            <view class="value">{{ authorizeItem.bigOrderNo }}</view>
                        </view>
                        <view class="detail-row">
                            <view class="label">订单备注：</view>
                            <view class="value">{{authorizeItem.orderDesc}}</view>
                        </view>
                        <view class="detail-row">
                            <view class="label">业务类型：</view>
                            <view class="value">
                                <dict-transform dict="BizType" code="{{authorizeItem.bizType}}"></dict-transform>
                            </view>
                        </view>
                        <view class="status-operate">
                            <view class="f-w-bold {{authorizeStatusOps[authorizeItem.status].textColor}}">
                                <dict-transform dict="AuthorizeStatus" code="{{authorizeItem.status}}"></dict-transform>
                            </view>
                        </view>
                        <view class="status-watermark">
                            <image class="status-image" src="{{authorizeStatusOps[authorizeItem.status].imageUrl}}" lazy-load="true" />
                        </view>
                    </view>
                </block>
            </block>
        </block>
        <view wx:else>
            <empty-list type="approval" tips="暂无审批内容"></empty-list>
        </view>
    </scroll-view>
</view>