<view class="flex-direction-column d-flex h-full">
    <top-bar class="z-index-1">
        <view class="d-flex relative">
            <view class="f-s-13 text-grey1 absolute" style="top:0;bottom:0;height:1em;line-height:1em;margin:auto;" bindtap="throttleShowNotice">
                发票须知
            </view>
            <view class="flex-1 text-center f-s-16 f-w-bold">选择发票</view>
        </view>
    </top-bar>
    <view class="flex-1 h-1 bg-grey9 overflow-auto p-x-10 p-y-12 text-grey1 f-s-14">
        <view class="form-group r-6">
            <view class="form-item {{ errMsgs.invoice ? 'has-error' : ''}} align-items-flex-start">
                <view class="label">发票抬头</view>
                <view class="control">
                    <view class="content" bindtap="throttleChangeInvoice">
                        <view class="flex-1">
                            <view wx:if="{{invoice}}">
                                <view class="d-flex">
                                    <view class="f-s-12 m-r-20 b-1 b-primary text-primary p-x-4 r-4">
                                        <dict-transform dict="InvoiceType" code="{{invoice.type}}"></dict-transform>
                                    </view>
                                    <view>{{invoice.title}}</view>
                                </view>
                                <view class="d-flex m-t-6 text-grey2" wx:if="{{invoice.registrationNo}}">
                                    <view>发票税号：</view>
                                    <view>{{invoice.registrationNo}}</view>
                                </view>
                            </view>
                        </view>
                        <iconfont icon="arrow-right" />
                    </view>
                    <view class="error">{{errMsgs.invoice}}</view>
                </view>
            </view>
            <view class="form-item {{ errMsgs.email ? 'has-error' : ''}}">
                <view class="label">收件邮箱</view>
                <view class="control">
                    <view class="content">
                        <teh-input type="text" placeholder="请输入收件邮箱(必填)" value="{{formData.email}}" class="flex-1" data-name="email" bindinput="handleInput" />
                    </view>
                    <view class="error">{{errMsgs.email}}</view>
                </view>
            </view>
        </view>
        <view class="form-group m-t-6 r-6">
            <view class="form-item {{ errMsgs.memo ? 'has-error' : ''}}">
                <view class="label">发票备注</view>
                <view class="control">
                    <view class="content">
                        <teh-input type="text" placeholder="请输入发票备注(选填)" value="{{formData.memo}}" class="flex-1" data-name="memo" bindinput="handleInput" />
                    </view>
                    <view class="error">{{errMsgs.memo}}</view>
                </view>
            </view>
        </view>
    </view>
    <view class="z-index-1 p-x-10 p-y-16 box-shadow-footer">
        <button class="bg-btn-primary text-white f-w-bold f-s-16 r-full l-h-42" bindtap="throttleConfirm">
            确定
        </button>
    </view>
</view>
<van-popup show="{{ popupVisible }}" round closeable position="bottom" custom-style="height: 890rpx" bind:close="throttlePopupClose">
    <view class="d-flex flex-direction-column f-s-14 text-grey1 h-full overrun-popup bg-grey9">
        <view class="p-y-18">
            <view class="f-w-bold f-s-16 text-center">抬头选择</view>
        </view>
        <scroll-view class="flex-1 h-1" scroll-y="{{true}}">
            <view class="p-x-10 p-t-6">
                <view class="p-16 bg-white r-6 m-b-12" wx:for="{{invoiceList}}" wx:key="index" data-invoice="{{item}}" bindtap="throttleConfirmInvoice">
                    <view class="d-flex align-items-center">
                        <view class="flex-1">
                            <view class="d-flex align-items-center">
                                <view class="f-s-16 f-w-bold">{{item.title}}</view>
                                <view class="f-s-10 bg-blue4 text-primary r-6 p-x-4 m-l-18" wx:if="{{item.defaulted}}">
                                    默认
                                </view>
                            </view>
                            <view class="f-s-12 text-grey3 m-y-6" wx:if="{{item.registrationNo}}">
                                税号 {{item.registrationNo}}
                            </view>
                            <view class="f-s-12 text-grey3">
                                <dict-transform dict="InvoiceType" code="{{item.type}}"></dict-transform>
                            </view>
                        </view>
                        <view class="f-s-20 text-grey4" bindtap="throttleToEditInvoice" data-invoice="{{item}}">
                            <iconfont icon="modify"></iconfont>
                        </view>
                    </view>
                </view>
            </view>
        </scroll-view>
        <view class="p-x-10 p-y-16 ">
            <button bindtap="throttlePay" class="bg-btn-primary text-white f-w-bold f-s-16 r-full l-h-42" bindtap="throttleToAddInvoice">
                添加新的抬头
            </button>
        </view>
    </view>
</van-popup>
<loading wx:if="{{isLoading}}" title="{{loadingTitle}}" />
<van-dialog id="van-dialog" confirm-button-color="#3642ff" />