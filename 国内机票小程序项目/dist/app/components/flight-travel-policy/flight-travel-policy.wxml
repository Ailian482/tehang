<view class="policy-hang-btn" bindtap="handleShowPopup">
    <text decode="true">差旅\n政策</text>
</view>
<van-popup show="{{ showPopup }}" round position="bottom" custom-style="max-height: 70%;" lock-scroll="true" bind:close="handleClosePopup">
    <view class="popup-header-container">
        <view class="popup-header">
            <view>差旅政策</view>
            <iconfont icon="close" bindtap="handleClosePopup"></iconfont>
        </view>
    </view>
    <view class="travel-policy-container" wx:if="{{approvalPolicy}}">
        <!-- 审批政策Start -->
        <view class="approve-policy" wx:if="{{approvalPolicy}}">
            <view class="header">
                <iconfont icon="approval" size="16" class="text-gradient"></iconfont>
                <view class="title">出差审批</view>
            </view>
            <view class="content" wx:if="{{approvalPolicy.approvalEnabled}}">
                <view class="approval-item">
                    <view class="text-grey2 m-b-10">审批规则</view>
                    <view class="rule-info">
                        <view class="d-flex">
                            <view class="m-r-4">1.</view>
                            <view>
                                {{approvalPolicy.approvalRequired  ? '预订时必须填入出差审批单': '预订时可以选填出差审批单'}}
                            </view>
                        </view>
                        <view class="d-flex">
                            <view class="m-r-4">2.</view>
                            <view>
                                <dict-transform dict="ApprovalStatusRequireInCreateOrder" code="{{approvalPolicy.approvalStatusRequireInCreateOrder}}"></dict-transform>
                            </view>
                        </view>
                    </view>
                </view>
                <view class="approval-item">
                    <view class="text-grey2 m-b-10">审批人</view>
                    <view>
                        <block wx:for="{{approvalPolicy.approvalProcess.firstAuditEmployees}}" wx:key="id">
                            {{item.name}}
                        </block>
                        <block wx:if="{{approvalPolicy.approvalProcess.secondAuditEmployees.length}}">
                            <iconfont class="text-white-gray f-s-12 m-x-12" icon="arrow-fill"></iconfont>
                        </block>
                        <block wx:for="{{approvalPolicy.approvalProcess.secondAuditEmployees}}" wx:key="id">
                            {{item.name}}
                        </block>
                    </view>
                </view>
            </view>
            <view class="content" wx:else>不需要审批</view>
        </view>
        <!-- 审批政策End -->
        <view class="authorize-policy">
            <view class="header">
                <iconfont icon="overrun-auth" size="16" class="text-gradient"></iconfont>
                <view class="title">超标授权</view>
            </view>
            <!-- 超标授权政策 -->
            <view class="content" wx:if="{{authorizePolicy.authorizeEnabled}}">
                <view class="policy-item">
                    <view class="policy-item-label">授权规则：</view>
                    <view class="policy-item-value">
                        {{ overrunPolicyOptions[authorizePolicy.overrunPolicyOption] }}
                    </view>
                </view>
                <view class="policy-item">
                    <view class="policy-item-label">超标授权人：</view>
                    <view class="policy-item-value d-flex align-items-center">
                        <block wx:for="{{authorizePolicy.authorizeProcess.firstAuditEmployees}}" wx:key="id">
                            {{item.name}}
                        </block>
                        <block wx:if="{{authorizePolicy.authorizeProcess.secondAuditEmployees.length}}">
                            <iconfont class="text-white-gray f-s-12 m-x-12" icon="arrow-fill"></iconfont>
                        </block>
                        <block wx:for="{{authorizePolicy.authorizeProcess.secondAuditEmployees}}" wx:key="id">
                            {{item.name}}
                        </block>
                    </view>
                </view>
            </view>
            <view class="content" wx:else>不需要授权</view>
            <!-- 国内机票差标 -->
            <view class="policy-name f-s-14" wx:if="{{flightPolicy && flightPolicy.enabled}}">
                <view class="f-w-bold">差旅政策名称：</view>
                <view>{{travelPolicyName}}</view>
            </view>
            <view class="flight-policy" wx:if="{{flightPolicy && flightPolicy.enabled}}">
                <view class="policy-header">
                    <image class="prefix-area" src="{{prefixAreaUrl}}" lazy-load="true" />
                    <view class="policy-title">国内机票差标</view>
                    <image class="prefix-area" src="{{postfixAreaUrl}}" lazy-load="true" />
                </view>
                <view class="flight-policy-detail-table" wx:if="{{flightPolicy.preDaysEnabled || flightPolicy.compareHoursEnabled || flightPolicy.discountLimitEnabled || flightPolicy.departureTimeLimitEnabled}}">
                    <view class="table-row border-b" wx:if="{{flightPolicy.preDaysEnabled}}">
                        <view class="col-item col-label">提前预订管控</view>
                        <view class="col-item col-value">需提前{{flightPolicy.preDays}}天预订</view>
                    </view>
                    <view class="table-row" wx:if="{{flightPolicy.compareHoursEnabled || flightPolicy.discountLimitEnabled}}">
                        <view class="col-item col-label">航班低价管控</view>
                        <view class="col-item col-value">
                            <block wx:if="{{flightPolicy.compareHoursEnabled}}">
                                需选择前后{{flightPolicy.compareHours}}小时最低价预订
                            </block>
                            <block wx:if="{{flightPolicy.discountLimitEnabled}}">
                                国内机票不能超过{{flightPolicy.discountLimit}}折
                            </block>
                        </view>
                    </view>
                    <view class="table-row border-t" wx:if="{{flightPolicy.departureTimeLimitEnabled}}">
                        <view class="col-item col-label">起飞时间管控</view>
                        <view class="col-item col-value">
                            仅可预订
                            <block wx:for="{{flightPolicy.limitedDepartureTimeInWeekday}}" wx:for-item="date" wx:for-index="idx" wx:key="*this">
                                {{ date.startTime }}-{{ date.endTime }}
                                <block wx:if="{{idx < flightPolicy.limitedDepartureTimeInWeekday.length -1}}">
                                    /
                                </block>
                            </block>
                            (周一至周五);
                            <block wx:for="{{flightPolicy.limitedDepartureTimeInWeekend}}" wx:for-item="date" wx:for-index="idx" wx:key="*this">
                                {{ date.startTime }}-{{ date.endTime }}
                                <block wx:if="{{idx < flightPolicy.limitedDepartureTimeInWeekend.length-1}}">
                                    /
                                </block>
                            </block>
                            (周一至周五);
                        </view>
                    </view>
                </view>
                <view class="travel-requirement" wx:if="{{flightPolicy.travelRequirement}}">
                    <view class="f-w-bold">补充说明：</view>
                    <view class="flex-1 text-right">{{flightPolicy.travelRequirement}}</view>
                </view>
            </view>
        </view>
        <view class="notify-policy">
            <view class="header">
                <iconfont icon="notify" size="16" class="text-gradient"></iconfont>
                <view class="title">知会信息</view>
            </view>
            <view class="content" wx:if="{{notifyPolicy.enabled}}">
                <view class="policy-item">
                    <view class="policy-item-label">知会人：</view>
                    <view class="flex-1">
                        <block wx:for="{{notifyPolicy.notifyProcess.notifierEmployees}}" wx:key="id">
                            {{item.name}}
                        </block>
                    </view>
                </view>
            </view>
            <view class="content" wx:else>暂未开启知会</view>
        </view>
    </view>
    <view wx:else>暂无差旅配置</view>
</van-popup>