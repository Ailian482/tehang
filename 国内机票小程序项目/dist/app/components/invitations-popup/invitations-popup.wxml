<van-popup show="{{ visible }}" custom-class="popup-container" close-on-click-overlay="{{canClose}}" round bind:close="throttleClose">
    <view class="invitation-detail-container">
        <view class="header">
            <image class="header-icon" src="{{modalHeaderIconUrl}}" lazy-load="true" />
            <block wx:if="{{canClose}}">
                <iconfont icon="close" bindtap="handleHideOverlay" bindtap="throttleClose"></iconfont>
            </block>
        </view>
        <view class="nav-list" wx:if="{{invitations.length > 1}}">
            <block wx:for="{{invitations}}" wx:key="*this">
                <view class="invitation-nav {{currentIndex === index ? 'active' : ''}}" data-index="{{index}}" bindtap="handleChangeSelected">
                    我的邀请{{index + 1}}
                </view>
            </block>
        </view>
        <!-- key 这里使用*this，invitations项会移除，数组不更新 -->
        <block wx:for="{{invitations}}" wx:key="*this">
            <view wx:if="{{currentIndex === index}}" class="invitation-item">
                <view wx:if="{{item.status === 'Accepted'}}" class="accept-content f-s-16 f-w-bold text-grey1 text-center">
                    <view class="m-b-4">您已成功加入</view>
                    <view>{{item.corpSummaryInfoDto.corpName}}</view>
                </view>
                <view wx:elif="{{item.status === 'Refused'}}" class="refuse-content">
                    <view class="f-s-16 f-w-bold text-grey1 text-center">您已拒绝该邀请</view>
                </view>
                <!-- 待处理 -->
                <view wx:else>
                    <view class="component-info">
                        <view class="f-w-bold">{{item.corpSummaryInfoDto.corpName}}邀请您加入</view>
                        <view class="m-t-10">邀请人：{{item.inviterEmployeeInfoDto.name}}</view>
                    </view>
                    <view class="employee-info m-t-10">
                        <view>员工姓名：{{item.inviteeEmployeeInfoDto.name}}</view>
                        <view>部门：{{item.inviteeEmployeeInfoDto.departmentName}}</view>
                        <view>
                            联系手机：
                            <number-encrypt value="{{item.inviteeEmployeeInfoDto.mobile}}" encryptType="Mobile"></number-encrypt>
                        </view>
                        <!-- 证件号：取第一个展示 -->
                        <view wx:if="{{item.inviteeEmployeeInfoDto.documents.length}}">
                            <dict-transform dict="DocType" code="{{item.inviteeEmployeeInfoDto.documents[0].docType}}"></dict-transform>
                            ：
                            <number-encrypt value="{{item.inviteeEmployeeInfoDto.documents[0].docNo}}" encryptType="{{ item.inviteeEmployeeInfoDto.documents[0].docType}}"></number-encrypt>
                        </view>
                    </view>
                    <view class="expiration-info f-s-14">
                        请尽快处理，该邀请将于
                        <count-down expireTimestamp="{{item.codeExpireTimestamp}}"></count-down>
                        后过期
                    </view>
                    <view class="operate-group">
                        <view class="join-btn" data-index="{{index}}" data-code="{{item.invitationCode}}" bindtap="handleAcceptInvitation">
                            确认加入
                        </view>
                        <view class="text-center text-primary f-s-14 m-t-18" data-index="{{index}}" data-code="{{item.invitationCode}}" bindtap="handleRefuseInvitation">
                            这不是我的机构
                        </view>
                    </view>
                </view>
            </view>
        </block>
    </view>
</van-popup>